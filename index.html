<!DOCTYPE html>
<html lang="sr">
<head>
<meta charset="UTF-8">
<title>AnaLingo ðŸŽµ</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<style>
body { font-family:'Poppins',sans-serif; background: linear-gradient(135deg,#f5f0ff,#ffe5f0); display:flex; flex-direction:column; align-items:center; padding:40px; }
h1 { color:#7e1389; text-align:center; margin-bottom:20px; }
p.description { color:#333; font-size:1.1rem; text-align:center; margin-bottom:40px; }
#assignForm, #adminForm { background:#fff; padding:20px 30px; border-radius:15px; margin-bottom:20px; display:flex; flex-direction:column; align-items:center; gap:10px; }
input { padding:10px; font-size:16px; border:1px solid #ccc; border-radius:6px; width:220px; }
button { padding:10px 20px; font-size:16px; border:none; border-radius:6px; background:#7e1389; color:#fff; cursor:pointer; }
button:hover { background:#38063f; }
#result, #adminResult, #adminRemaining { margin-top:10px; min-height:1.2em; text-align:center; font-weight:600; }
#result.assigned { color:#007700; }
#result.error { color:#7e1389; }
</style>
</head>
<body>

<h1>AnaLingo â–¶ dodela jezika ðŸŽµðŸŽ§</h1>
<p class="description">Unesi svoj nick sa foruma i dobiÄ‡eÅ¡ jezik svog predloga za AnaLingo!ðŸ”®</p>

<!-- USER -->
<div id="assignForm">
  <input type="text" id="username" placeholder="Unesi svoj nick ðŸ’œ">
  <button onclick="assignLanguage()">Dodeli jezik</button>
  <div id="result"></div>
</div>

<!-- ADMIN -->
<div id="adminForm">
  <input type="password" id="adminPassword" placeholder="Admin lozinka ðŸ”’">
  <button onclick="loadAdmin()">PrikaÅ¾i sve dodele</button>
  <button onclick="resetLanguages()">Resetuj jezike</button>
  <div id="adminResult"></div>
  <div id="adminRemaining"></div>
</div>

<script>
const BASE_URL = "https://script.google.com/macros/s/AKfycbyLBIv9p1IOU602UZkdYZkZACF7JTnRpTF3PWT68QZfHhdcN7OlDWtjM07pJD5WCrh1cg/exec"; // 

function assignLanguage(){
  const username = document.getElementById("username").value.trim();
  const result = document.getElementById("result");
  if(!username){ result.textContent="Unesi nick ðŸ’œ"; result.className="error"; return; }
  result.textContent="Loading..."; result.className="";
  const cb = "cb_"+Date.now()+"_"+Math.floor(Math.random()*1000);
  window[cb] = function(data){
    if(data.error){ result.textContent=data.error; result.className="error"; }
    else if(data.assigned && data.message){ result.textContent=data.message; result.className="assigned"; }
    else{ result.textContent="Dodeljen ti je jezik: "+data.assigned; result.className="assigned"; }
    delete window[cb];
  };
  const s = document.createElement("script");
  s.src = BASE_URL+"?username="+encodeURIComponent(username)+"&callback="+cb;
  document.body.appendChild(s);
}

function loadAdmin(){
  const pw = document.getElementById("adminPassword").value.trim();
  const adminResult = document.getElementById("adminResult");
  const remainingDiv = document.getElementById("adminRemaining");
  if(!pw){ adminResult.textContent="Unesi lozinku"; return; }
  adminResult.textContent="Loading..."; remainingDiv.textContent="";
  const cb = "cb_"+Date.now()+"_"+Math.floor(Math.random()*1000);
  window[cb] = function(data){
    if(data.error){ adminResult.textContent=data.error; }
    else{
      const list = Object.entries(data.assigned).map(([k,v])=>k+" â†’ "+v).join("<br>");
      adminResult.innerHTML = list || "JoÅ¡ niko nije dobio jezik ðŸ’œ";

      const remList = Object.entries(data.languages).map(([k,v])=>k+" : "+v).join("<br>");
      remainingDiv.innerHTML = "<strong>Preostali jezici:</strong><br>"+remList;
    }
    delete window[cb];
  };
  const s = document.createElement("script");
  s.src = BASE_URL+"?admin=true&adminPassword="+encodeURIComponent(pw)+"&callback="+cb;
  document.body.appendChild(s);
}

function resetLanguages(){
  const pw = document.getElementById("adminPassword").value.trim();
  if(!pw){ alert("Unesi lozinku"); return; }
  if(pw !== "ANALINGOTEST1234"){ alert("PogreÅ¡na lozinka"); return; }
  const cb = "cb_"+Date.now()+"_"+Math.floor(Math.random()*1000);
  window[cb] = function(data){
    alert("Jezici su resetovani!");
    delete window[cb];
    loadAdmin(); // refresh
  };
  const s = document.createElement("script");
  s.src = BASE_URL+"?reset=true&callback="+cb;
  document.body.appendChild(s);
}
</script>

</body>
</html>
